<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Incoming Inspection VD - Sample Overview</title>
    <style>
        @media (max-width: 600px){
            .container {
                width: 100%;
                padding: 10px;
            }
            .table {
                overflow-x: auto; /* Permite rolagem horizontal */
            }
            .stats {
                width: 100%;
                padding: 10px;
            }
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f0f4f8;
            color: #333;
        }

        .navigation {
            padding: 20px;
            background-color: #0033a0; /* Royal Blue */
            color: white;
            text-align: left;
            margin-bottom: 20px;
        }

        .navigation a {
            color: white;
            text-decoration: none;
            font-weight: bold;
            margin: 0 10px;
        }

        .navigation a:hover {
            text-decoration: underline;
        }

        h1 {
            text-align: center;
            color: #0033a0; /* Royal Blue */
        }

        .container {
            width: 90%;
            margin: auto;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .stats {
            width: 100%;
            display: inline-flex;
            flex-direction: initial;
            flex-wrap: wrap;
            margin: auto;
        }

        .stat-box {
            text-align: center;
            flex: 1;
            padding: 10px;
            background-color: #f0f8ff;
            border-radius: 8px;
            margin: 5px;
        }

        .export-button {
            text-align: right;
            margin: 20px 0;
        }

        .export-button button {
            background-color: #002366;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        table {
            display: block;
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            flex-wrap: wrap;
            overflow-x: auto; /* Permite rolagem horizontal */
        }

        table, th, td {
            border: 1px solid #ddd;
            justify-content: center;
        }

        th, td {
            padding: 10px;
            text-align: center;
            width: 9%;
        }

        th {
            background-color: #0033a0; /* Royal Blue */
            color: white;
        }

        .status-in-progress {
            color: blue;
        }

        .status-pending {
            color: red;
        }

        .status-finalized {
            color: green;
        }
        
        .graphics {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

    </style>
</head>
<body>
    
    <h1>Incoming Inspection VD - Sample Overview</h1>
    <div class="container">
        <div class="navigation">
            <a href="index.html">Cadastrar Novo Item</a>
            <a href="list.html">Lista de Itens</a>
        </div>

        <div class="stats">
            <div class="stat-box">
                <h2 id="totalSamples">0</h2>
                <p>Total de Inspeções</p>
            </div>
            <div class="stat-box">
                <h2 id="inProgressSamples">0</h2>
                <p>Inspeções em Andamento</p>
            </div>
            <div class="stat-box">
                <h2 id="pendingItems">0</h2>
                <p>Itens Pendentes</p>
            </div>
            <div class="stat-box">
                <h2 id="completedSamples">0</h2>
                <p>Inspeções Finalizadas</p>
            </div>
            <div class="stat-box">
                <h2 id="samplePlanInProgress">0</h2>
                <p>Amostras em Inspeção</p>
            </div>
            <div class="stat-box">
                <h2 id="samplePlanCompleted">0</h2>
                <p>Amostras liberadas</p>
            </div>
        </div>
        
        <div class="graphics">
            <div id="chartDiv" style="width:50%; height:300px; margin:0 auto; text-align: center;"></div>
            <div id="chartDiv2" style="width:50%; height:300px; margin:0 auto;"></div>
        </div>
        
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Data Input</th>
                        <th>Inspection Lot</th>
                        <th>Número Planta</th>
                        <th>Locação</th>
                        <th>Material</th>
                        <th>Descrição</th>
                        <th>Qtd Lote</th>
                        <th>Plano Amostra</th>
                        <th>Status</th>
                        <th>Colaborador IQC</th>
                        <th>Hora de Conclusão</th>
                    </tr>
                </thead>
                <tbody id="dashboardTableBody">
                    <!-- Os dados da tabela serão preenchidos dinamicamente -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
    function formatDate(dateTimeString) {
        const date = new Date(dateTimeString);
        return date.toLocaleString('pt-BR', { timeZone: 'America/Manaus' });
    }

    function loadSamples() {
        return fetch('http://52.67.36.220/app')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Erro ao buscar os dados do servidor');
                }
                return response.json();
            })
            .then(samples => {
                updateDashboard(samples);
                renderCharts(samples);
            })
            .catch(error => {
                console.error('Erro ao carregar dados:', error);
                alert('Erro ao carregar dados do servidor.');
            });
    }

    function updateDashboard(samples) {
        let totalSamples = 0;
        let inProgressSamples = 0;
        let pendingItems = 0;
        let completedSamples = 0;
        let samplePlanInProgress = 0;
        let samplePlanCompleted = 0;
        
        const dashboardTableBody = document.getElementById('dashboardTableBody');
        dashboardTableBody.innerHTML = '';

        samples.forEach(sample => {
            totalSamples += 1;

            if (sample.status === 'Em Processo de Inspeção') {
                inProgressSamples += 1;
                samplePlanInProgress += parseInt(sample.samplePlan) || 0;
            } else if (sample.status === 'Pendente de Inspeção') {
                pendingItems += 1;
            } else if (sample.status === 'Finalizado') {
                completedSamples += 1;
                samplePlanCompleted += parseInt(sample.samplePlan) || 0;
            }

            const row = dashboardTableBody.insertRow();
            row.insertCell(0).textContent = formatDate(sample.inputData);
            row.insertCell(1).textContent = sample.inspectionLot;
            row.insertCell(2).textContent = sample.plantNumber;
            row.insertCell(3).textContent = sample.location;
            row.insertCell(4).textContent = sample.material;
            row.insertCell(5).textContent = sample.description;
            row.insertCell(6).textContent = sample.quantity;
            row.insertCell(7).textContent = sample.samplePlan;

            // Atribuindo classe de status para colorir o texto
            const statusCell = row.insertCell(8);
            statusCell.textContent = sample.status;
            statusCell.classList.add(sample.status === 'Em Processo de Inspeção' ? 'status-in-progress' : sample.status === 'Pendente de Inspeção' ? 'status-pending' : 'status-finalized');

            row.insertCell(9).textContent = sample.iqcCollaborator;
            row.insertCell(10).textContent = sample.finishTime ? formatDate(sample.finishTime) : '---';
        });

        document.getElementById('totalSamples').textContent = totalSamples;
        document.getElementById('inProgressSamples').textContent = inProgressSamples;
        document.getElementById('pendingItems').textContent = pendingItems;
        document.getElementById('completedSamples').textContent = completedSamples;
        document.getElementById('samplePlanInProgress').textContent = samplePlanInProgress;
        document.getElementById('samplePlanCompleted').textContent = samplePlanCompleted;
    }

    function renderCharts(samples) {
        // Exemplo de gráfico simples
        const statusCounts = samples.reduce((counts, sample) => {
            counts[sample.status] = (counts[sample.status] || 0) + 1;
            return counts;
        }, {});

        const chart = JSC.chart('chartDiv', {
            title_label_text: 'Inspeções por Status',
            series: [
                {
                    points: Object.keys(statusCounts).map(status => ({
                        x: status,
                        y: statusCounts[status]
                    }))
                }
            ]
        });

        // Exemplo de gráfico de quantidades de amostras por status
        const planCounts = samples.reduce((counts, sample) => {
            if (sample.status === 'Finalizado') {
                counts.completed += parseInt(sample.samplePlan) || 0;
            } else if (sample.status === 'Em Processo de Inspeção') {
                counts.inProgress += parseInt(sample.samplePlan) || 0;
            }
            return counts;
        }, { completed: 0, inProgress: 0 });

        const chart2 = JSC.chart('chartDiv2', {
            title_label_text: 'Amostras por Status',
            series: [
                {
                    points: [
                        { x: 'Amostras Finalizadas', y: planCounts.completed },
                        { x: 'Amostras em Inspeção', y: planCounts.inProgress }
                    ]
                }
            ]
        });
    }

    document.addEventListener('DOMContentLoaded', () => {
        loadSamples();
    });   
    </script>

</body>
<script src="https://code.jscharting.com/2.9.0/jscharting.js"></script>
<script src="app.js"></script>
</html>
